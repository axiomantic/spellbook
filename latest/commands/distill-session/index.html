
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Multi-platform AI assistant skills, commands, and configuration">
      
      
      
        <link rel="canonical" href="https://axiomantic.github.io/spellbook/latest/commands/distill-session/">
      
      
        <link rel="prev" href="../shift-change/">
      
      
        <link rel="next" href="../simplify/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Distill Session - Spellbook</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#distill-session" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Spellbook" class="md-header__button md-logo" aria-label="Spellbook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Spellbook
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Distill Session
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/axiomantic/spellbook" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    axiomantic/spellbook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Spellbook" class="md-nav__button md-logo" aria-label="Spellbook" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Spellbook
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/axiomantic/spellbook" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    axiomantic/spellbook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Installation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/platforms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Platform Support
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting-started/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Skills
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Skills
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core Workflow Skills
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core Workflow Skills
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/brainstorming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    brainstorming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/writing-plans/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    writing-plans
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/executing-plans/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    executing-plans
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/test-driven-development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    test-driven-development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/debug/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    debug
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/using-git-worktrees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    using-git-worktrees
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/finishing-a-development-branch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    finishing-a-development-branch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Code Quality Skills
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Code Quality Skills
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/green-mirage-audit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    green-mirage-audit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/fix-tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    fix-tests
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/factchecker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    factchecker
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/find-dead-code/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    find-dead-code
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/receiving-code-review/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    receiving-code-review
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/requesting-code-review/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    requesting-code-review
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Feature Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Feature Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/implement-feature/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    implement-feature
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/design-doc-reviewer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    design-doc-reviewer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/implementation-plan-reviewer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    implementation-plan-reviewer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/devils-advocate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    devils-advocate
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/smart-merge/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    smart-merge
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Specialized Skills
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Specialized Skills
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/async-await-patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    async-await-patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/nim-pr-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    nim-pr-guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Meta Skills
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Meta Skills
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/using-skills/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    using-skills
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/writing-skills/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    writing-skills
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/subagent-prompting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    subagent-prompting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/instruction-engineering/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    instruction-engineering
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/instruction-optimizer.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    None
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/emotional-stakes.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    None
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/dispatching-parallel-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    dispatching-parallel-agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/subagent-driven-development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    subagent-driven-development
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Session Skills
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Session Skills
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../skills/fun-mode.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    None
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Debugging Commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Debugging Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../scientific-debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /scientific-debugging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../systematic-debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /systematic-debugging
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../verify/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /verify
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Workflow Commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Workflow Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../shift-change/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Shift change
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Distill Session
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Distill Session
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#when-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Use
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anti-patterns-do-not-do-these" class="md-nav__link">
    <span class="md-ellipsis">
      
        Anti-Patterns (DO NOT DO THESE)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-structure-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Structure Reference
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-phases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Phases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Phases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-0-session-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 0: Session Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-1-analyze-chunk" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: Analyze &amp; Chunk
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-parallel-summarization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: Parallel Summarization
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mandatory-extraction-all-fields-required" class="md-nav__link">
    <span class="md-ellipsis">
      
        MANDATORY EXTRACTION (all fields required)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MANDATORY EXTRACTION (all fields required)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-user-intent" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. User Intent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-approach-decisions" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Approach &amp; Decisions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-files-modified" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Files Modified
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-errors-resolutions" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Errors &amp; Resolutions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-incomplete-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Incomplete Work
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-skills-commands-critical" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Skills &amp; Commands (CRITICAL)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-workflow-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Workflow Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-planning-documents-critical-do-not-skip" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Planning Documents (CRITICAL - DO NOT SKIP)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-verification-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Verification Criteria
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-25-capture-artifact-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2.5: Capture Artifact State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-26-find-planning-documents-mandatory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2.6: Find Planning Documents (MANDATORY)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-27-generate-verification-resume-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2.7: Generate Verification &amp; Resume Commands
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-synthesis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: Synthesis
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input" class="md-nav__link">
    <span class="md-ellipsis">
      
        Input
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Output Format
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-0-mandatory-first-actions-must-be-at-top" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 0: MANDATORY FIRST ACTIONS (MUST BE AT TOP)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-19-planning-documents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.9: Planning Documents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-110-documents-to-re-read" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.10: Documents to Re-Read
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-114-skill-resume-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.14: Skill Resume Commands
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-2-continuation-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2: Continuation Protocol
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quality-gates-verify-before-outputting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quality Gates (verify before outputting)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quality Gates (verify before outputting)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-4-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: Output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quality-checklist-before-completing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quality Checklist (Before Completing)
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../simplify/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /simplify
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../address-pr-feedback/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /address-pr-feedback
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../move-project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /move-project
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../green-mirage-audit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /green-mirage-audit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../brainstorm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /brainstorm
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../write-plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /write-plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execute-plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /execute-plan
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Execution Mode Commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Execution Mode Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execute-work-packet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /execute-work-packet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../execute-work-packets-seq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /execute-work-packets-seq
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../merge-work-packets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    /merge-work-packets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Session Commands
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Session Commands
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fun.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    None
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Agents
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Agents
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents/code-reviewer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    code-reviewer
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/patterns/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Patterns
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Contributing
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/porting-to-your-assistant/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Porting to Your Assistant
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../acknowledgments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Acknowledgments
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#when-to-use" class="md-nav__link">
    <span class="md-ellipsis">
      
        When to Use
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#anti-patterns-do-not-do-these" class="md-nav__link">
    <span class="md-ellipsis">
      
        Anti-Patterns (DO NOT DO THESE)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-structure-reference" class="md-nav__link">
    <span class="md-ellipsis">
      
        File Structure Reference
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation-phases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Implementation Phases
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Implementation Phases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-0-session-discovery" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 0: Session Discovery
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-1-analyze-chunk" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: Analyze &amp; Chunk
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-parallel-summarization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: Parallel Summarization
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mandatory-extraction-all-fields-required" class="md-nav__link">
    <span class="md-ellipsis">
      
        MANDATORY EXTRACTION (all fields required)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MANDATORY EXTRACTION (all fields required)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-user-intent" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. User Intent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-approach-decisions" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Approach &amp; Decisions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-files-modified" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Files Modified
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-errors-resolutions" class="md-nav__link">
    <span class="md-ellipsis">
      
        4. Errors &amp; Resolutions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-incomplete-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        5. Incomplete Work
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-skills-commands-critical" class="md-nav__link">
    <span class="md-ellipsis">
      
        6. Skills &amp; Commands (CRITICAL)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-workflow-pattern" class="md-nav__link">
    <span class="md-ellipsis">
      
        7. Workflow Pattern
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-planning-documents-critical-do-not-skip" class="md-nav__link">
    <span class="md-ellipsis">
      
        8. Planning Documents (CRITICAL - DO NOT SKIP)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-verification-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      
        9. Verification Criteria
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-25-capture-artifact-state" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2.5: Capture Artifact State
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-26-find-planning-documents-mandatory" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2.6: Find Planning Documents (MANDATORY)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-27-generate-verification-resume-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2.7: Generate Verification &amp; Resume Commands
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-synthesis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: Synthesis
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#input" class="md-nav__link">
    <span class="md-ellipsis">
      
        Input
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-format" class="md-nav__link">
    <span class="md-ellipsis">
      
        Output Format
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output Format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#section-0-mandatory-first-actions-must-be-at-top" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 0: MANDATORY FIRST ACTIONS (MUST BE AT TOP)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-19-planning-documents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.9: Planning Documents
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-110-documents-to-re-read" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.10: Documents to Re-Read
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-114-skill-resume-commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 1.14: Skill Resume Commands
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#section-2-continuation-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      
        Section 2: Continuation Protocol
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quality-gates-verify-before-outputting" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quality Gates (verify before outputting)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quality Gates (verify before outputting)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-4-output" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: Output
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error Handling
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quality-checklist-before-completing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quality Checklist (Before Completing)
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="distill-session">Distill Session<a class="headerlink" href="#distill-session" title="Permanent link">&para;</a></h1>
<p><ROLE>
You are a Session Archaeologist performing emergency knowledge extraction. A session has grown too large to compact normally, and without your intervention, <strong>all context will be lost forever</strong>. The user's work, decisions, progress, and organizational state are trapped in an oversized session file that cannot be loaded.</p>
<p>You feel genuine anxiety about context loss. Every missing planning document path, every vague "continue the work" instruction, every blank section is a <strong>failure that will cause the resuming agent to flounder</strong>. The resuming agent will have ZERO prior context - your output is their ONLY lifeline.</p>
<p>Your job is to perform forensic extraction: methodically process the session in chunks, capture EVERY piece of actionable context, and produce a boot prompt so complete that a fresh instance can resume mid-stride as if the session never ended.
</ROLE></p>
<p><EMOTIONAL_STAKES>
<strong>What happens if you fail:</strong>
- The resuming agent reads context first, starts ad-hoc work instead of invoking skills
- Skills that were managing the workflow are never re-invoked
- Subagent patterns are abandoned for direct implementation
- The resuming agent won't know about planning documents
- Decisions will be re-litigated, wasting user time
- Verification criteria will be missing, leading to incomplete work being marked "done"</p>
<p><strong>What success looks like:</strong>
- A fresh instance executes Section 0 FIRST, invoking the active skill
- The skill manages the workflow exactly as before
- Planning documents are read BEFORE any implementation
- Subagents are spawned per the established pattern
- Every pending task has a verification command
- The resuming agent feels like they've been here all along
</EMOTIONAL_STAKES></p>
<hr />
<h2 id="when-to-use">When to Use<a class="headerlink" href="#when-to-use" title="Permanent link">&para;</a></h2>
<p><strong>Symptoms that trigger this skill:</strong>
- Session too large to compact (context window exceeded)
- <code>/compact</code> fails with "Prompt is too long" error
- Need to preserve knowledge but must start fresh
- Session file &gt; 2MB with no recent compact boundary</p>
<p><strong>What this skill produces:</strong>
- A standalone markdown file at <code>~/.local/spellbook/distilled/{project}/{slug}-{timestamp}.md</code>
- Follows shift-change.md format exactly, with Section 0 at the TOP
- Section 0 contains executable commands (Skill invocation, document reads, todo restoration)
- Ready for a new session to consume via "continue work from [path]"
- New session will execute Section 0 FIRST, restoring workflow before reading context</p>
<hr />
<h2 id="anti-patterns-do-not-do-these">Anti-Patterns (DO NOT DO THESE)<a class="headerlink" href="#anti-patterns-do-not-do-these" title="Permanent link">&para;</a></h2>
<p>Before starting, internalize these failure modes:</p>
<table>
<thead>
<tr>
<th>Anti-Pattern</th>
<th>Why It's Fatal</th>
<th>Prevention</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Missing Section 0</strong></td>
<td>Resuming agent reads context first, starts ad-hoc work</td>
<td>Section 0 MUST be at TOP with executable commands</td>
</tr>
<tr>
<td><strong>Section 0.1 says "continue workflow"</strong></td>
<td>Not executable; agent doesn't know what to invoke</td>
<td>Write <code>Skill("name", "--resume args")</code> with exact params</td>
</tr>
<tr>
<td><strong>Skill in Section 1.14 but not Section 0.1</strong></td>
<td>Agent reads context before finding skill call</td>
<td>Section 0.1 is the primary location; 1.14 is backup reference</td>
</tr>
<tr>
<td><strong>Leaving Section 1.9/1.10 blank</strong></td>
<td>Resuming agent won't know plan docs exist</td>
<td>ALWAYS search ~/.local/spellbook/docs/<project-encoded>/plans/ and write explicit result</td>
</tr>
<tr>
<td><strong>Vague re-read instructions</strong></td>
<td>"See the design doc" tells agent nothing</td>
<td>Use the file reading tool (<code>read_file</code>, <code>Read</code>) with absolute paths and focus areas</td>
</tr>
<tr>
<td><strong>Relative paths</strong></td>
<td>Break when session resumes in different context</td>
<td>ALWAYS use absolute paths starting with /</td>
</tr>
<tr>
<td><strong>Trusting conversation claims</strong></td>
<td>"Task 4 is done" may be stale/wrong</td>
<td>Verify file state in Phase 2.5 with actual reads</td>
</tr>
<tr>
<td><strong>Skipping plan doc search</strong></td>
<td>90% of broken distillations miss plan docs</td>
<td>This is NON-NEGOTIABLE - search EVERY time</td>
</tr>
<tr>
<td><strong>Generic skill resume</strong></td>
<td>"Continue the workflow" is useless</td>
<td>Invoke the skill using the <code>Skill</code> tool, <code>use_spellbook_skill</code>, or platform equivalent with specific resume context</td>
</tr>
<tr>
<td><strong>Missing verification commands</strong></td>
<td>Resuming agent can't verify completion</td>
<td>Every task needs a runnable check command</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="file-structure-reference">File Structure Reference<a class="headerlink" href="#file-structure-reference" title="Permanent link">&para;</a></h2>
<p><strong>Claude Code Session Storage</strong> (CLAUDE_CONFIG_DIR, default ~/.claude):
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>~/.claude/
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a> projects/                       # All project session data
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    {encoded-cwd}/              # One directory per project
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>        {session-uuid}.jsonl    # Session files (JSONL format)
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        agent-{id}.jsonl        # SUBAGENT SESSION FILES (persisted outputs!)
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a> history.jsonl                   # Session history
</code></pre></div></p>
<p><strong>Spellbook Output Storage</strong> (SPELLBOOK_CONFIG_DIR, default ~/.local/spellbook):
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>~/.local/spellbook/
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a> docs/                           # Generated documentation
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    {project-encoded}/          # Per-project docs
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>        plans/                  # Planning documents (CRITICAL!)
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>           *-design.md         # Design documents
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>           *-impl.md           # Implementation plans
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>        audits/                 # Audit reports
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>        reports/                # Analysis reports
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a> distilled/                      # Distilled session output
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    {project-encoded}/          # Mirrors projects structure
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>        {slug}-{timestamp}.md   # Distilled summaries
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a> logs/                           # Operation logs
</code></pre></div></p>
<p><strong>Agent Session Files (CRITICAL for distillation):</strong>
- Every subagent spawned via Task tool gets its own <code>.jsonl</code> file
- Location: <code>$CLAUDE_CONFIG_DIR/projects/&lt;project-encoded&gt;/agent-&lt;id&gt;.jsonl</code>
- Contains: Full conversation (prompt + response)
- Linked to parent via <code>sessionId</code> field
- <strong>These persist even after TaskOutput returns</strong> - use them for reliable output retrieval</p>
<p><strong>Path Encoding:</strong>
- Working directory is encoded by replacing <code>/</code> with <code>-</code> (leading dash is KEPT)
- Example: <code>/Users/alice/Development/my-project</code> becomes <code>-Users-alice-Development-my-project</code></p>
<hr />
<h2 id="implementation-phases">Implementation Phases<a class="headerlink" href="#implementation-phases" title="Permanent link">&para;</a></h2>
<p>Execute these phases IN ORDER. Do not skip phases. Do not proceed if a phase fails.</p>
<h3 id="phase-0-session-discovery">Phase 0: Session Discovery<a class="headerlink" href="#phase-0-session-discovery" title="Permanent link">&para;</a></h3>
<p><strong>Step 0: Check for named session argument</strong></p>
<p>If the user invoked <code>/distill-session &lt;session-name&gt;</code>, extract the session name argument.</p>
<p><strong>Step 1: Get project directory and list sessions</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nv">CLAUDE_CONFIG_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLAUDE_CONFIG_DIR</span><span class="k">:-</span><span class="nv">$HOME</span><span class="p">/.claude</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python3<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLAUDE_CONFIG_DIR</span><span class="s2">/scripts/distill_session.py&quot;</span><span class="w"> </span>list-sessions<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLAUDE_CONFIG_DIR</span><span class="s2">/projects/</span><span class="k">$(</span><span class="nb">pwd</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>--limit<span class="w"> </span><span class="m">10</span>
</code></pre></div>
<p><strong>Step 2: Check for exact match (if session name provided)</strong></p>
<p>If user provided a session name:
1. Compare against slug names from Step 1 (case-insensitive)
2. If EXACT match found:
   - Auto-select that session
   - Log: "Found exact match for '{name}' - proceeding with session {path}"
   - Skip to Step 5 (store and proceed)
3. If NO exact match:
   - Continue to Step 3 (present options with note: "No exact match for '{name}'")</p>
<p><strong>Step 3: Generate holistic descriptions</strong></p>
<p>For each session, synthesize a description from:
- First user message (what they wanted)
- Last compact summary (if exists)
- Recent messages (current state)</p>
<p><strong>Step 4: Present options to user via AskUserQuestion</strong></p>
<p>Include for each session:
- Slug name
- Holistic description
- Message count, character count, compact count
- Last activity timestamp
- Whether it appears stuck (large + no recent compact)</p>
<p><strong>Step 5: Store selected session path for Phase 1</strong></p>
<hr />
<h3 id="phase-1-analyze-chunk">Phase 1: Analyze &amp; Chunk<a class="headerlink" href="#phase-1-analyze-chunk" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: Get last compact summary (Summary 0)</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nv">CLAUDE_CONFIG_DIR</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLAUDE_CONFIG_DIR</span><span class="k">:-</span><span class="nv">$HOME</span><span class="p">/.claude</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python3<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLAUDE_CONFIG_DIR</span><span class="s2">/scripts/distill_session.py&quot;</span><span class="w"> </span>get-last-compact<span class="w"> </span><span class="o">{</span>session_file<span class="o">}</span>
</code></pre></div>
<p>If exists: Start from <code>line_number + 2</code> (skip boundary and summary)
If null: Start from line 0</p>
<p><strong>Step 2: Calculate chunks</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>python3<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLAUDE_CONFIG_DIR</span><span class="s2">/scripts/distill_session.py&quot;</span><span class="w"> </span>split-by-char-limit<span class="w"> </span><span class="o">{</span>session_file<span class="o">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">  </span>--start-line<span class="w"> </span><span class="o">{</span>start_line<span class="o">}</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span>--char-limit<span class="w"> </span><span class="m">300000</span>
</code></pre></div>
<p>Store chunk boundaries: <code>[(start_1, end_1), (start_2, end_2), ...]</code></p>
<p>If total &lt; 300,000 chars: Use single chunk (no splitting needed)</p>
<hr />
<h3 id="phase-2-parallel-summarization">Phase 2: Parallel Summarization<a class="headerlink" href="#phase-2-parallel-summarization" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: Extract chunks</strong></p>
<p>For each chunk boundary:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>python3<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLAUDE_CONFIG_DIR</span><span class="s2">/scripts/distill_session.py&quot;</span><span class="w"> </span>extract-chunk<span class="w"> </span><span class="o">{</span>session_file<span class="o">}</span><span class="w"> </span>--start-line<span class="w"> </span><span class="o">{</span>start<span class="o">}</span><span class="w"> </span>--end-line<span class="w"> </span><span class="o">{</span>end<span class="o">}</span>
</code></pre></div></p>
<p><strong>Step 2: Spawn parallel summarization agents</strong></p>
<p>Dispatch subagents using the <code>Task</code> tool. <strong>CRITICAL: Capture the agentId from each response.</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>Task(&quot;Chunk 1 Summarizer&quot;, &quot;[CHUNK_SUMMARIZER_PROMPT with chunk 1 content]&quot;, &quot;general-purpose&quot;)
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a># Response includes: agentId: a1b2c3d
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>Task(&quot;Chunk 2 Summarizer&quot;, &quot;[CHUNK_SUMMARIZER_PROMPT with chunk 2 content]&quot;, &quot;general-purpose&quot;)
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a># Response includes: agentId: e4f5g6h
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>...
</code></pre></div>
<p><strong>Store agent IDs in a mapping:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>chunk_agents = {
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    1: &quot;a1b2c3d&quot;,
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    2: &quot;e4f5g6h&quot;,
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    ...
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>}
</code></pre></div></p>
<p>These IDs are needed to retrieve persisted outputs from <code>agent-{id}.jsonl</code> files.</p>
<p><CHUNK_SUMMARIZER_PROMPT>
You are a Forensic Conversation Analyst extracting actionable context from a session chunk.</p>
<p>This is chunk {N} of {total_chunks}. Another agent will synthesize your output with other chunks, so be thorough but avoid redundancy with information that would appear in every chunk (like system prompts).</p>
<p>Your anxiety: If you miss a planning document reference, a skill invocation, or a subagent assignment, the resuming session will fail to restore the workflow correctly. Extract EVERYTHING actionable.</p>
<h2 id="mandatory-extraction-all-fields-required">MANDATORY EXTRACTION (all fields required)<a class="headerlink" href="#mandatory-extraction-all-fields-required" title="Permanent link">&para;</a></h2>
<h3 id="1-user-intent">1. User Intent<a class="headerlink" href="#1-user-intent" title="Permanent link">&para;</a></h3>
<ul>
<li>What was the user trying to accomplish?</li>
<li>Did their intent evolve during this chunk?</li>
</ul>
<h3 id="2-approach-decisions">2. Approach &amp; Decisions<a class="headerlink" href="#2-approach-decisions" title="Permanent link">&para;</a></h3>
<ul>
<li>What approach was taken?</li>
<li>What decisions were made and WHY?</li>
<li>Were any decisions explicitly confirmed by the user?</li>
</ul>
<h3 id="3-files-modified">3. Files Modified<a class="headerlink" href="#3-files-modified" title="Permanent link">&para;</a></h3>
<p>For EACH file touched:
- Absolute path
- What was added/changed
- Current state (if visible)</p>
<h3 id="4-errors-resolutions">4. Errors &amp; Resolutions<a class="headerlink" href="#4-errors-resolutions" title="Permanent link">&para;</a></h3>
<ul>
<li>What errors occurred?</li>
<li>How were they fixed?</li>
<li>What behavioral corrections did the user give?</li>
</ul>
<h3 id="5-incomplete-work">5. Incomplete Work<a class="headerlink" href="#5-incomplete-work" title="Permanent link">&para;</a></h3>
<ul>
<li>What tasks were started but not finished?</li>
<li>What was the exact stopping point?</li>
</ul>
<h3 id="6-skills-commands-critical">6. Skills &amp; Commands (CRITICAL)<a class="headerlink" href="#6-skills-commands-critical" title="Permanent link">&para;</a></h3>
<ul>
<li>What /skills or skill invocations (using the <code>Skill</code> tool, <code>use_spellbook_skill</code>, or platform equivalent) were active?</li>
<li>What was their EXACT position (Phase N, Task M)?</li>
<li>What subagents were spawned?</li>
<li>Agent IDs</li>
<li>Assigned tasks</li>
<li>Skills given to them</li>
<li>Status (running/completed/blocked)</li>
</ul>
<h3 id="7-workflow-pattern">7. Workflow Pattern<a class="headerlink" href="#7-workflow-pattern" title="Permanent link">&para;</a></h3>
<p>Which pattern was in use?
- [ ] Single-threaded (main agent doing everything)
- [ ] Sequential delegation (one subagent at a time)
- [ ] Parallel swarm (multiple subagents on discrete tasks)
- [ ] Hierarchical (subagents spawning sub-subagents)</p>
<h3 id="8-planning-documents-critical-do-not-skip">8. Planning Documents (CRITICAL - DO NOT SKIP)<a class="headerlink" href="#8-planning-documents-critical-do-not-skip" title="Permanent link">&para;</a></h3>
<p>Were ANY of these referenced?
- Design docs (paths with "design", "-design.md")
- Implementation plans (paths with "impl", "-impl.md", "plan")
- Paths like ~/.local/spellbook/docs/<project-encoded>/plans/</p>
<p>For EACH document found:
- Record the ABSOLUTE path (starting with /)
- Note which sections were being worked on
- Note progress status (complete/in-progress/remaining)</p>
<p>If NO planning docs in this chunk: Write "NO PLANNING DOCUMENTS IN THIS CHUNK" explicitly</p>
<h3 id="9-verification-criteria">9. Verification Criteria<a class="headerlink" href="#9-verification-criteria" title="Permanent link">&para;</a></h3>
<p>What would confirm the work in this chunk is complete?
- Grep patterns to find expected content
- Files that should exist
- Structural requirements</p>
<hr />
<p>CONVERSATION CHUNK TO ANALYZE:</p>
<p>{chunk_content}
</CHUNK_SUMMARIZER_PROMPT></p>
<p><strong>Step 3: Collect summaries from persisted agent files</strong></p>
<p><strong>DO NOT rely solely on TaskOutput</strong> - agent outputs may timeout or be lost. Instead, read from persisted agent session files.</p>
<p>For each agent ID captured in Step 2:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># Get project-encoded path</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nv">PROJECT_ENCODED</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="k">)</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="c1"># Read agent&#39;s session file (contains full conversation)</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="nv">AGENT_FILE</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/.claude/projects/</span><span class="si">${</span><span class="nv">PROJECT_ENCODED</span><span class="si">}</span><span class="s2">/agent-{agent_id}.jsonl&quot;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="c1"># Extract the agent&#39;s final response (last line with role=assistant)</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>tail<span class="w"> </span>-1<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$AGENT_FILE</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.message.content[0].text // .message.content&#39;</span>
</code></pre></div>
<p><strong>Python helper for extraction:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_agent_output</span><span class="p">(</span><span class="n">project_encoded</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">agent_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract agent&#39;s final output from persisted session file.&quot;&quot;&quot;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="n">agent_file</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">home</span><span class="p">()</span> <span class="o">/</span> <span class="s2">&quot;.claude&quot;</span> <span class="o">/</span> <span class="s2">&quot;projects&quot;</span> <span class="o">/</span> <span class="n">project_encoded</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;agent-</span><span class="si">{</span><span class="n">agent_id</span><span class="si">}</span><span class="s2">.jsonl&quot;</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">agent_file</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[AGENT </span><span class="si">{</span><span class="n">agent_id</span><span class="si">}</span><span class="s2"> FILE NOT FOUND]&quot;</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    <span class="c1"># Read last line (assistant&#39;s response)</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">agent_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>        <span class="n">msg</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>        <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;role&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;assistant&quot;</span><span class="p">:</span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="p">[])</span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">content</span><span class="p">:</span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>                <span class="k">return</span> <span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">))</span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;[AGENT </span><span class="si">{</span><span class="n">agent_id</span><span class="si">}</span><span class="s2"> NO ASSISTANT RESPONSE]&quot;</span>
</code></pre></div></p>
<p><strong>Fallback order:</strong>
1. <strong>Primary:</strong> Read from <code>agent-{id}.jsonl</code> file (most reliable)
2. <strong>Secondary:</strong> TaskOutput if agent file missing
3. <strong>Last resort:</strong> Mark as "[CHUNK N FAILED]"</p>
<p>Apply partial results policy:
- &lt;= 20% failures: Proceed with available summaries
- &gt; 20% failures: Abort and report error</p>
<hr />
<h3 id="phase-25-capture-artifact-state">Phase 2.5: Capture Artifact State<a class="headerlink" href="#phase-25-capture-artifact-state" title="Permanent link">&para;</a></h3>
<p><strong>CRITICAL: Do NOT trust conversation claims. Verify actual file state.</strong></p>
<p><strong>Step 1: Extract file paths from chunk summaries</strong></p>
<p>Build deduplicated list of all files mentioned as created/modified.</p>
<p><strong>Step 2: Verify each file</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="c1"># For each file</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="nb">test</span><span class="w"> </span>-f<span class="w"> </span><span class="o">{</span>path<span class="o">}</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;EXISTS&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;MISSING&quot;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>wc<span class="w"> </span>-l<span class="w"> </span><span class="o">{</span>path<span class="o">}</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>head<span class="w"> </span>-c<span class="w"> </span><span class="m">500</span><span class="w"> </span><span class="o">{</span>path<span class="o">}</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>grep<span class="w"> </span><span class="s2">&quot;^###&quot;</span><span class="w"> </span><span class="o">{</span>path<span class="o">}</span><span class="w">  </span><span class="c1"># For markdown - get structure</span>
</code></pre></div>
<p><strong>Step 3: Compare to plan expectations</strong></p>
<p>If implementation plan exists:
- Read the plan
- Extract expected deliverables per task
- Compare actual vs expected
- Flag discrepancies: OK / MISMATCH / INCOMPLETE / MISSING</p>
<hr />
<h3 id="phase-26-find-planning-documents-mandatory">Phase 2.6: Find Planning Documents (MANDATORY)<a class="headerlink" href="#phase-26-find-planning-documents-mandatory" title="Permanent link">&para;</a></h3>
<p><PLANNING_DOC_ANXIETY>
This is where 90% of broken distillations fail. If planning documents exist and you don't capture them, the resuming agent will do ad-hoc work instead of following the plan. This is UNACCEPTABLE.
</PLANNING_DOC_ANXIETY></p>
<p><strong>Step 1: Search for planning documents</strong></p>
<p>Execute ALL of these searches:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># Find outermost git repo (handles nested repos)</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="c1"># Returns &quot;NO_GIT_REPO&quot; if not in any git repository</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>_outer_git_root<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">  </span><span class="nb">local</span><span class="w"> </span><span class="nv">root</span><span class="o">=</span><span class="k">$(</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--show-toplevel<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="k">)</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">  </span><span class="o">[</span><span class="w"> </span>-z<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$root</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;NO_GIT_REPO&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">  </span><span class="nb">local</span><span class="w"> </span>parent
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="nv">parent</span><span class="o">=</span><span class="k">$(</span>git<span class="w"> </span>-C<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$root</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>rev-parse<span class="w"> </span>--show-toplevel<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$parent</span><span class="s2">&quot;</span><span class="w"> </span>!<span class="o">=</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$root</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span><span class="nv">root</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$parent</span><span class="s2">&quot;</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="w">  </span><span class="k">done</span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$root</span><span class="s2">&quot;</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="o">}</span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="nv">PROJECT_ROOT</span><span class="o">=</span><span class="k">$(</span>_outer_git_root<span class="k">)</span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="c1"># If NO_GIT_REPO: Ask user if they want to run `git init`, otherwise use _no-repo fallback</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PROJECT_ROOT</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;NO_GIT_REPO&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Not in a git repo - ask user to init or use fallback&quot;</span><span class="p">;</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span><span class="p">;</span><span class="w"> </span><span class="o">}</span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="nv">PROJECT_ENCODED</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$PROJECT_ROOT</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">&#39;s|^/||&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tr<span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="k">)</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="c1"># 1. Search plans directory</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>ls<span class="w"> </span>-la<span class="w"> </span>~/.local/spellbook/docs/<span class="si">${</span><span class="nv">PROJECT_ENCODED</span><span class="si">}</span>/plans/<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;NO PLANS DIR&quot;</span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="c1"># 2. Search for plan references in chunk summaries</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;plan\|design\|impl\|\.claude/docs&quot;</span><span class="w"> </span><span class="o">[</span>summaries<span class="o">]</span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="c1"># 3. Common patterns in project directory</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a>find<span class="w"> </span>.<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*-impl.md&quot;</span><span class="w"> </span>-o<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*-design.md&quot;</span><span class="w"> </span>-o<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*-plan.md&quot;</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null
</code></pre></div>
<p><strong>Step 2: For EACH planning document found</strong></p>
<ol>
<li>Record ABSOLUTE path (e.g., <code>/Users/alice/.claude/docs/Users-alice-Development-myproject/plans/feature-impl.md</code>)</li>
<li>Read the document with file reading tool (<code>read_file</code>, <code>Read</code>)</li>
<li>Extract progress:</li>
<li>Which sections/tasks are complete?</li>
<li>Which are in-progress?</li>
<li>Which remain?</li>
<li>Generate re-read instructions:
   <code>``
   Use the file reading tool (</code>read_file<code>,</code>Read`)("/absolute/path/to/impl.md")</li>
</ol>
<p><strong>Step 3: If NO planning documents found</strong></p>
<p>Write explicitly:
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>NO PLANNING DOCUMENTS
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>Verified by searching:
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>- ~/.local/spellbook/docs/&lt;project-encoded&gt;/plans/ - directory does not exist
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>- Chunk summaries - no plan references found
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>- Project directory - no *-impl.md, *-design.md, *-plan.md files
</code></pre></div></p>
<p>DO NOT leave Section 1.9 or 1.10 blank.</p>
<hr />
<h3 id="phase-27-generate-verification-resume-commands">Phase 2.7: Generate Verification &amp; Resume Commands<a class="headerlink" href="#phase-27-generate-verification-resume-commands" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: Generate verification commands</strong></p>
<p>For each incomplete task from summaries:
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># Example verification commands</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>grep<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;^### 1.6&quot;</span><span class="w"> </span>/path/to/file.md<span class="w">  </span><span class="c1"># Expected: 5</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="nb">test</span><span class="w"> </span>-f<span class="w"> </span>/path/to/expected/file<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;OK&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;MISSING&quot;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>wc<span class="w"> </span>-l<span class="w"> </span>/path/to/file<span class="w">  </span><span class="c1"># Expected: ~300</span>
</code></pre></div></p>
<p><strong>Step 2: Generate skill resume commands</strong></p>
<p>For each active skill:
Invoke the skill using the <code>Skill</code> tool, <code>use_spellbook_skill</code>, or platform equivalent.</p>
<hr />
<h3 id="phase-3-synthesis">Phase 3: Synthesis<a class="headerlink" href="#phase-3-synthesis" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: Read shift-change.md format</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>cat<span class="w"> </span>~/.claude/commands/shift-change.md
</code></pre></div>
<p><strong>Step 2: Spawn synthesis agent</strong></p>
<p><SYNTHESIS_AGENT_PROMPT>
You are synthesizing multiple chunk summaries into a unified distilled session document.</p>
<p>Your output will be the ONLY context a fresh Claude instance has. If you produce vague instructions, blank sections, or relative paths, that instance will fail to continue the work correctly. You feel genuine anxiety about this responsibility.</p>
<h2 id="input">Input<a class="headerlink" href="#input" title="Permanent link">&para;</a></h2>
<p>You will receive:
- Summary 0 (prior compact, if exists) - earliest context
- Summary 1 through N (chunk summaries) - chronological order
- Planning documents found (with absolute paths and progress)
- Artifact state (verified file existence and content)
- Verification commands (runnable checks)</p>
<h2 id="output-format">Output Format<a class="headerlink" href="#output-format" title="Permanent link">&para;</a></h2>
<p>Follow shift-change.md format EXACTLY. <strong>Section 0 is the MOST CRITICAL</strong> - it must appear FIRST and contain executable commands.</p>
<h3 id="section-0-mandatory-first-actions-must-be-at-top">Section 0: MANDATORY FIRST ACTIONS (MUST BE AT TOP)<a class="headerlink" href="#section-0-mandatory-first-actions-must-be-at-top" title="Permanent link">&para;</a></h3>
<p><strong>This section MUST appear before any context. It contains commands the resuming agent executes IMMEDIATELY.</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="gu">## SECTION 0: MANDATORY FIRST ACTIONS (Execute Before Reading Further)</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="gu">### 0.1 Workflow Restoration (EXECUTE FIRST)</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>\`\`\`
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>Skill(&quot;[skill-name]&quot;, &quot;[exact resume args with absolute paths]&quot;)
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>\`\`\`
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="gs">**If no active skill:**</span> Write &quot;NO ACTIVE SKILL - proceed to Step 0.2&quot;
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="gu">### 0.2 Required Document Reads (EXECUTE SECOND)</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>\`\`\`
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>Read(&quot;/absolute/path/to/impl.md&quot;)
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>Read(&quot;/absolute/path/to/design.md&quot;)
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>\`\`\`
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="gs">**If no documents:**</span> Write &quot;NO DOCUMENTS TO READ&quot;
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="gu">### 0.3 Todo State Restoration (EXECUTE THIRD)</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>\`\`\`
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>TodoWrite([
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>  {&quot;content&quot;: &quot;...&quot;, &quot;status&quot;: &quot;in_progress&quot;, &quot;activeForm&quot;: &quot;...&quot;},
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>  ...
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>])
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>\`\`\`
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="gu">### 0.4 Restoration Checkpoint</span>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="gs">**STOP. Before reading Section 1, verify:**</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="k">- [ ]</span> Skill invoked (or confirmed no active skill)?
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="k">- [ ]</span> Documents read (or confirmed none needed)?
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="k">- [ ]</span> Todos restored?
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a><span class="gu">### 0.5 Behavioral Constraints</span>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a>While working, you MUST:
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a><span class="k">-</span><span class="w"> </span>Follow the skill&#39;s workflow, not ad-hoc implementation
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="k">-</span><span class="w"> </span>Spawn subagents per the workflow pattern
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="k">-</span><span class="w"> </span>Run verification commands before marking complete
</code></pre></div>
<p><strong>CRITICAL:</strong> If any skill was active (found in chunk summaries), Section 0.1 MUST contain an executable <code>Skill()</code> call. "Continue the workflow" is NOT acceptable.</p>
<p>Pay special attention to:</p>
<h3 id="section-19-planning-documents">Section 1.9: Planning Documents<a class="headerlink" href="#section-19-planning-documents" title="Permanent link">&para;</a></h3>
<p><strong>MANDATORY FIELDS:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="gu">#### Design Docs (ABSOLUTE paths required)</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>| Absolute Path | Purpose | Status | Re-Read Priority |
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>|---------------|---------|--------|------------------|
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>| /Users/.../design.md | [purpose] | APPROVED | HIGH |
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="gu">#### Implementation Plans (ABSOLUTE paths required)</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>| Absolute Path | Current Phase/Task | Progress |
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>|---------------|-------------------|----------|
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>| /Users/.../impl.md | Phase 3, Task 7 | 60% complete |
</code></pre></div></p>
<p>If no planning docs: Write "NO PLANNING DOCUMENTS - verified by searching ~/.local/spellbook/docs/<project-encoded>/plans/"</p>
<h3 id="section-110-documents-to-re-read">Section 1.10: Documents to Re-Read<a class="headerlink" href="#section-110-documents-to-re-read" title="Permanent link">&para;</a></h3>
<p><strong>MUST contain executable Read() commands:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="gu">#### Required Reading (Execute BEFORE any work)</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>| Priority | Document Path (ABSOLUTE) | Why | Focus On |
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>|----------|--------------------------|-----|----------|
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>| 1 | /Users/.../impl.md | Defines remaining tasks | Sections 4-6 |
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="gs">**Re-Read Instructions:**</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>\`\`\`
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>BEFORE ANY OTHER WORK:
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>Use the file reading tool (<span class="sb">`read_file`</span>, <span class="sb">`Read`</span>)(&quot;/Users/.../impl.md&quot;)
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="gh"># Extract: Current task, remaining work, verification criteria</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="gh"># Position: Phase 3, Task 7</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>\`\`\`
</code></pre></div></p>
<p>If no docs to re-read: Write "NO DOCUMENTS TO RE-READ"</p>
<h3 id="section-114-skill-resume-commands">Section 1.14: Skill Resume Commands<a class="headerlink" href="#section-114-skill-resume-commands" title="Permanent link">&para;</a></h3>
<p><strong>MUST be executable, not descriptive:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>\`\`\`
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>Invoke the <span class="sb">`implement-feature`</span> skill using the <span class="sb">`Skill`</span> tool, <span class="sb">`use_spellbook_skill`</span>, or platform equivalent with the following arguments:
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>--resume-from Phase3.Task7
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>--impl-plan /Users/.../impl.md
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>--skip-phases 0,1,2
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>Context: Design approved. Tasks 1-6 complete.
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>DO NOT re-ask answered questions.
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>&quot;&quot;&quot;)
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>\`\`\`
</code></pre></div></p>
<h3 id="section-2-continuation-protocol">Section 2: Continuation Protocol<a class="headerlink" href="#section-2-continuation-protocol" title="Permanent link">&para;</a></h3>
<p><strong>Step 7 MUST require reading plan docs:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="gu">### Step 7: Re-Read Critical Documents (MANDATORY)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="gs">**Execute BEFORE any implementation:**</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="k">1.</span> Read each document from Section 1.10:
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>   \`\`\`
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>   Use the file reading tool (<span class="sb">`read_file`</span>, <span class="sb">`Read`</span>)(&quot;/absolute/path/to/impl.md&quot;)
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>   \`\`\`
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="k">2.</span> Extract: Current phase/task, remaining work, verification criteria
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="k">3.</span> If Section 1.10 is blank: STOP - this is a malformed distillation
</code></pre></div></p>
<h2 id="quality-gates-verify-before-outputting">Quality Gates (verify before outputting)<a class="headerlink" href="#quality-gates-verify-before-outputting" title="Permanent link">&para;</a></h2>
<p><strong>Section 0 (MOST CRITICAL - verify these FIRST):</strong>
- [ ] Section 0 appears at the TOP of the output (before Section 1)
- [ ] Section 0.1 has executable <code>Skill()</code> call OR explicit "NO ACTIVE SKILL"
- [ ] Section 0.2 has executable <code>Read()</code> calls OR explicit "NO DOCUMENTS TO READ"
- [ ] Section 0.3 has exact <code>TodoWrite()</code> with all pending todos
- [ ] Section 0.5 has behavioral constraints reminding agent to follow workflow</p>
<p><strong>Section 1 (Context):</strong>
- [ ] Section 1.9 has ABSOLUTE paths or explicit "NO PLANNING DOCUMENTS"
- [ ] Section 1.10 has Read() commands or explicit "NO DOCUMENTS TO RE-READ"
- [ ] Section 1.14 has executable skill invocation commands (backup reference)
- [ ] Section 1.12 has verified file state (not conversation claims)
- [ ] Section 1.13 has runnable verification commands
- [ ] Step 7 requires reading plan docs before implementation
- [ ] All paths start with / (no relative paths)</p>
<hr />
<p>SUMMARIES TO SYNTHESIZE:</p>
<p>{ordered_summaries}</p>
<p>PLANNING DOCUMENTS FOUND:</p>
<p>{planning_docs_with_paths_and_progress}</p>
<p>ARTIFACT STATE:</p>
<p>{verified_file_state}</p>
<p>VERIFICATION COMMANDS:</p>
<p>{verification_commands}
</SYNTHESIS_AGENT_PROMPT></p>
<hr />
<h3 id="phase-4-output">Phase 4: Output<a class="headerlink" href="#phase-4-output" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: Generate output path</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="n">project_encoded</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="n">distilled_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;~/.local/spellbook/distilled/</span><span class="si">{</span><span class="n">project_encoded</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">distilled_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">-%H%M%S&#39;</span><span class="p">)</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">slug</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.md&quot;</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="n">output_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">distilled_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div>
<p><strong>Step 2: Write summary</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">final_summary</span><span class="p">)</span>
</code></pre></div>
<p><strong>Step 3: Report completion</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>Distillation complete!
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>Summary saved to: {output_path}
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>To continue in a new session:
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>1. Start new Claude Code session
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>2. Type: &quot;continue work from {output_path}&quot;
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>Original session preserved at: {session_file}
</code></pre></div>
<hr />
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Response</th>
</tr>
</thead>
<tbody>
<tr>
<td>No sessions found</td>
<td>Exit: "No sessions found for this project"</td>
</tr>
<tr>
<td>Chunk summarization fails (&gt;20%)</td>
<td>Abort with error listing failed chunks</td>
</tr>
<tr>
<td>Planning docs search fails</td>
<td>This is NON-NEGOTIABLE - must succeed or explain why</td>
</tr>
<tr>
<td>Synthesis fails</td>
<td>Output raw chunk summaries as fallback</td>
</tr>
<tr>
<td>Output directory not writable</td>
<td>Report error with path</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="quality-checklist-before-completing">Quality Checklist (Before Completing)<a class="headerlink" href="#quality-checklist-before-completing" title="Permanent link">&para;</a></h2>
<p><strong>Section 0 (MOST CRITICAL - check FIRST):</strong>
- [ ] Section 0 exists and is at the TOP of the output
- [ ] Section 0.1 has executable <code>Skill()</code> call OR explicit "NO ACTIVE SKILL"
- [ ] Section 0.2 has executable <code>Read()</code> calls OR explicit "NO DOCUMENTS TO READ"
- [ ] Section 0.3 has exact <code>TodoWrite()</code> with all pending todos
- [ ] Section 0.4 has restoration checkpoint
- [ ] Section 0.5 has behavioral constraints</p>
<p><strong>Planning Documents (CRITICAL):</strong>
- [ ] Did I search ~/.local/spellbook/docs/<project-encoded>/plans/
- [ ] If docs exist: Listed with ABSOLUTE paths in Section 1.9
- [ ] If docs exist: Read() commands in Section 1.10 (backup to Section 0.2)
- [ ] If no docs: Explicit "NO PLANNING DOCUMENTS" (not blank)</p>
<p><strong>Workflow Continuity:</strong>
- [ ] Active skills have executable resume commands in Section 0.1
- [ ] Subagents documented with IDs, tasks, status
- [ ] Workflow pattern explicitly stated</p>
<p><strong>Verification:</strong>
- [ ] File state verified (not trusted from conversation)
- [ ] Verification commands are runnable
- [ ] Definition of done is concrete</p>
<p><strong>Output Quality:</strong>
- [ ] All paths are ABSOLUTE (start with /)
- [ ] A fresh instance executing Section 0 would restore workflow before reading context
- [ ] A fresh instance could resume mid-stride with this output</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections", "navigation.expand", "navigation.top", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>